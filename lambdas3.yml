
AWSTemplateFormatVersion: 2010-09-09
Description: create articutlure for recommendation system
Resources:
  lambdaFunction:
    Type: AWS::Lambda::Function
    Properties:
      Description: lambda
      FunctionName: lambdatest
      Handler: index.handler
      MemorySize: 256
      Role: arn:aws:iam::989713268372:role/service-role/dataextraction
      Runtime: nodejs14.x
      Timeout: 600
      Code:
        ZipFile: |
          exports.handler = function(event, context, callback) {
          var response = {
          statusCode: 200,
          headers: {
              'Content-Type': 'text/html; charset=utf-8'
          },
          body: '<p>Bonjour au monde!</p>'
          }
          callback(null, response)
          }
  S3Buckettest:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: recommendationssystembucketdata123456
  ScheduledRule: 
    Type: AWS::Events::Rule
    Properties: 
      Description: "ScheduledRule"
      ScheduleExpression: "rate(10 minutes)"
      State: "ENABLED"
      Targets: 
        - 
          Arn: 
            Fn::GetAtt: 
              - "lambdaFunction"
              - "Arn"
          Id: "TargetFunctionV1"
  PermissionForEventsToInvokeLambda: 
    Type: AWS::Lambda::Permission
    Properties: 
      FunctionName: 
        Ref: "lambdaFunction"
      Action: "lambda:InvokeFunction"
      Principal: "events.amazonaws.com"
      SourceArn: 
        Fn::GetAtt: 
          - "ScheduledRule"
          - "Arn"

